<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
 

<img id="displayImage">

<div id="cropBorder" style="width: 2in; height: 2in; border: 1px solid rgb(225, 43, 43); position: absolute;">
</div>
<input type="file" id="imageUpload" accept="image/jpeg"> 
<button id="moveCropLeft">Left</button>
<button id="moveCropRight">Right</button>
<button id="moveCropUp">Up</button> 
<button id="moveCropDown">Down</button>

<button id="cropImage">Crop Image</button>

<a id="downloadCropped">Download Cropped Image</a>

<script>

const imageUpload = document.getElementById('imageUpload');
const displayImage = document.getElementById('displayImage');
const cropBorder = document.getElementById('cropBorder');

imageUpload.addEventListener('change', e => {
  const file = e.target.files[0];
  
  const reader = new FileReader();
  reader.onload = () => {
    displayImage.src = reader.result;
  }
  reader.readAsDataURL(file);
});

const moveDistance = 10; // pixels

document.getElementById('moveCropLeft').addEventListener('click', () => {
  cropBorder.style.left = Math.max(0, cropBorder.offsetLeft - moveDistance) + 'px';
});

document.getElementById('moveCropRight').addEventListener('click', () => {
  cropBorder.style.left = Math.min(displayImage.width - cropBorder.offsetWidth, cropBorder.offsetLeft + moveDistance) + 'px';  
});

document.getElementById('moveCropUp').addEventListener('click', () => {
  cropBorder.style.top = Math.max(0, cropBorder.offsetTop - moveDistance) + 'px';
});

document.getElementById('moveCropDown').addEventListener('click', () => {
  cropBorder.style.top = Math.min(displayImage.height - cropBorder.offsetHeight, cropBorder.offsetTop + moveDistance) + 'px';
});
// Make crop border draggable
let dragActive = false;
cropBorder.addEventListener('mousedown', () => {
  dragActive = true;
});

document.addEventListener('mouseup', () => {
  dragActive = false;
});

cropBorder.addEventListener('mousemove', e => {
  if (dragActive) {
    cropBorder.style.left = Math.min(displayImage.width - cropBorder.offsetWidth, Math.max(0, e.pageX - cropBorder.offsetWidth/2)) + 'px';
    cropBorder.style.top = Math.min(displayImage.height - cropBorder.offsetHeight, Math.max(0, e.pageY - cropBorder.offsetHeight/2)) + 'px';
  }
});





document.getElementById('cropImage').addEventListener('click', () => {
  // Use canvas to crop image
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  
  canvas.width = cropBorder.offsetWidth;
  canvas.height = cropBorder.offsetHeight;  

  ctx.drawImage(displayImage, cropBorder.offsetLeft, cropBorder.offsetTop, canvas.width, canvas.height, 0, 0, canvas.width, canvas.height);
  
  // Generate download
  const downloadLink = document.getElementById('downloadCropped');
  downloadLink.href = canvas.toDataURL('image/jpeg');
  downloadLink.download = 'cropped.jpeg';
});

</script>

</body>
</html>
